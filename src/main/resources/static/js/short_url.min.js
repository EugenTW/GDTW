'use strict';document.addEventListener("DOMContentLoaded",function(){function m(a){return!a||a.length>200?!1:/^https:\/\/[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,}(:\d+)?(\/.*)?$/.test(a)}function n(){const a=c.value.trim(),d=m(a);h.disabled=!d||a===p}function q(a){navigator.clipboard.writeText(a).then(()=>{l("\u77ed\u7db2\u5740\u5df2\u8907\u88fd\u5230\u526a\u8cbc\u7c3f / The short URL is copied!","darkgreen")}).catch(d=>{console.error("Failed to copy text: ",d);l("\u7121\u6cd5\u8907\u88fd\u77ed\u7db2\u5740 / Unable to copy the short URL.",
    "darkred")})}function l(a,d){const b=document.createElement("div");b.textContent=a;b.style.position="fixed";b.style.top="50%";b.style.left="50%";b.style.transform="translate(-50%, -50%)";b.style.background="#00FF00";b.style.color="#000000";b.style.border="2px solid #227700";b.style.padding="15px";b.style.borderRadius="5px";b.style.zIndex="9999";b.style.borderWidth="3px";document.body.appendChild(b);setTimeout(()=>{b.style.transition="opacity 0.3s";b.style.opacity=0;setTimeout(()=>b.remove(),300)},
    1500)}const c=document.getElementById("long_url");if(c){function a(d){d.style.height=d.scrollHeight+"px"}a(c);c.addEventListener("input",function(){a(this)});c.addEventListener("paste",function(){setTimeout(()=>a(this),0)})}const h=document.getElementById("generate"),f=document.getElementById("shorten_url"),g=document.getElementById("qrcode");let p="";c.addEventListener("input",n);c.addEventListener("paste",function(a){a.preventDefault();a=(a.clipboardData||window.clipboardData).getData("text");c.value=
    a.trim();n()});c.addEventListener("blur",function(){const a=c.value.trim();m(a)||(c.value="",l("\u8acb\u8f38\u5165\u6709\u6548\u7684 HTTPS \u7db2\u5740\u4e14\u4e0d\u8d85\u904e 200 \u5b57\u5143 - Please enter a valid HTTPS URL, and it should not exceed 200 characters.","darkred"),h.disabled=!0)});h.addEventListener("click",function(){function a(){fetch("/su_api/create_new_short_url",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({originalUrl:d})}).then(e=>e.status===
429?(b++,b<5?setTimeout(a,1E3):(f.textContent="\u4f3a\u670d\u5668\u5fd9\u788c\u7a0d\u5f8c\u518d\u8a66 - Server busy. Try later.",f.style.backgroundColor="pink",g.style.display="none"),null):e.json()).then(e=>{if(e){var k=e.fullShortUrl;e=e.message;k?(f.textContent=k,f.style.backgroundColor="yellow",f.onclick=()=>q(k),g.innerHTML="",new QRCode(g,{text:k,width:100,height:100}),g.style.display="block",q(k),p=d.trim()):(f.textContent=e,f.style.backgroundColor="pink",g.style.display="none")}}).catch(e=>
{console.error(e);f.textContent="\u932f\u8aa4: \u8acb\u7a0d\u5f8c\u518d\u8a66! Error: Please try again later.";f.style.backgroundColor="pink";g.style.display="none"}).finally(()=>{h.disabled=!0})}const d=c.value.trim();if(m(d)){h.disabled=!0;var b=0;a()}else l("\u8acb\u8f38\u5165\u6b63\u78ba\u7684 URLhttps \u958b\u982d\u4e14\u4e0d\u8d85\u904e 200 \u5b57\u5143 - Please enter a correct URL (starting with https and not exceeding 200 characters).","darkred")})});