'use strict';const REPORT_TYPE_MAP={url:1,album:2,image:3},REPORT_REASON_MAP={child:1,violence:2,hate:3,scam:4,other:5};let _captchaVal="",targetClearTimeout=null;
function extractTargetId(a,c){a=a.trim();a=a.replace(/^https?:\/\//i,"");a=a.match(/^(gdtw\.org|localhost)(\/.+)?$/i);if(!a)return null;a=a[2]||"/";a=a.split("?")[0];a=a.split("/").filter(b=>b.length>0);if(c==="url"){if(a.length===1&&/^[A-Za-z0-9]{4}$/.test(a[0]))return a[0]}else if(c==="album"){if(a.length===2&&a[0]==="a"&&/^[A-Za-z0-9]{6}$/.test(a[1]))return a[1]}else if(c==="image"&&a.length===2&&a[0]==="i"&&/^[A-Za-z0-9]{6}$/.test(a[1]))return a[1];return null}
function isValidTargetUrl(a,c){return c?!!extractTargetId(a,c):!0}
function handleTargetInput(){const a=document.getElementById("report-type").value,c=document.getElementById("report-target"),b=c.value;targetClearTimeout&&(clearTimeout(targetClearTimeout),targetClearTimeout=null);a&&b&&!isValidTargetUrl(b,a)?(c.style.borderColor="#a1002b",targetClearTimeout=setTimeout(function(){c.value="";c.placeholder="\u8acb\u8f38\u5165\u6b63\u78ba\u7684\u76ee\u6a19\u7db2\u5740 / Please enter a valid report URL";c.style.borderColor="#a1002b";checkFormReady()},500)):c.style.borderColor=
    "";checkFormReady()}function generateCaptcha(){return Math.floor(100+Math.random()*900).toString()+Math.floor(100+Math.random()*900).toString()}function setCaptcha(){_captchaVal=generateCaptcha();document.getElementById("captcha-value").textContent=String(_captchaVal.slice(0,3))+" "+String(_captchaVal.slice(3))}
function showAlert(a,c=!0){const b=document.createElement("div");b.style.position="fixed";b.style.left="50%";b.style.top="50%";b.style.transform="translate(-50%, -50%)";b.style.background=c?"#185a36":"#a1002b";b.style.color="#fff";b.style.padding="15px 15px";b.style.borderRadius="10px";b.style.fontSize="16px";b.style.fontWeight="bold";b.style.zIndex="9999";b.style.textAlign="center";b.innerHTML=a;document.body.appendChild(b);setTimeout(function(){document.body.removeChild(b)},3E3)}
function isValidCaptcha(a){return a===_captchaVal}
function resetForm(){document.getElementById("report-type").selectedIndex=0;document.getElementById("report-reason").selectedIndex=0;document.getElementById("report-target").value="";document.getElementById("report-target").placeholder="\u8acb\u8f38\u5165\u76ee\u6a19\u7db2\u5740 / Enter the URL of report target";document.getElementById("report-target").style.borderColor="";document.getElementById("captcha-input").value="";document.getElementById("captcha-input").placeholder="\u8acb\u8f38\u5165\u4e0a\u65b9\u516d\u4f4d\u6578\u5b57 / Enter the 6-digit number above";
    setCaptcha();document.querySelector(".report-submit").disabled=!0;targetClearTimeout&&(clearTimeout(targetClearTimeout),targetClearTimeout=null)}function checkFormReady(){const a=document.getElementById("report-type").value,c=document.getElementById("report-reason").value,b=document.getElementById("report-target").value,e=document.getElementById("captcha-input").value;document.querySelector(".report-submit").disabled=!(a&&c&&b&&isValidTargetUrl(b,a)&&e.length===6&&isValidCaptcha(e))}
document.addEventListener("DOMContentLoaded",function(){setCaptcha();document.getElementById("refresh-captcha").onclick=function(a){a.preventDefault();setCaptcha();document.getElementById("captcha-input").value="";document.getElementById("captcha-input").placeholder="\u8acb\u8f38\u5165\u4e0a\u65b9\u516d\u4f4d\u6578\u5b57 / Enter the 6-digit number above";checkFormReady()};document.getElementById("report-type").onchange=function(){handleTargetInput();checkFormReady()};document.getElementById("report-reason").onchange=
    checkFormReady;document.getElementById("report-target").addEventListener("input",handleTargetInput);document.getElementById("report-target").addEventListener("blur",handleTargetInput);document.getElementById("report-target").addEventListener("paste",function(a){a.preventDefault();this.value=(a.clipboardData||window.clipboardData).getData("text");this.dispatchEvent(new Event("input"))});document.getElementById("captcha-input").addEventListener("input",function(){this.value.length>6&&(this.value=this.value.slice(0,
    6));checkFormReady()});document.getElementById("captcha-input").addEventListener("blur",function(){this.value&&!isValidCaptcha(this.value)&&(this.value="",this.placeholder="\u8acb\u91cd\u65b0\u8f38\u5165 / Please enter again",checkFormReady())});document.querySelector(".report-form").onsubmit=async function(a){a.preventDefault();document.querySelector(".report-submit").disabled=!0;a=document.getElementById("report-type").value;const c=document.getElementById("report-reason").value;var b=document.getElementById("report-target").value;
    b=extractTargetId(b,a);a={reportType:REPORT_TYPE_MAP[a]||0,reportReason:REPORT_REASON_MAP[c]||0,targetUrl:b||""};try{const e=await fetch("/rv_api/send_report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});let d;try{d=await e.json()}catch(f){d={}}d&&String(d.reportStatus)==="true"?showAlert("\u8209\u5831\u9001\u51fa\u6210\u529f\u8b1d\u8b1d\u60a8\x3cbr\x3eReport sent successfully, thank you!"):showAlert("\u932f\u8aa4 / Error: \x3cbr\x3e"+(d&&d.response?d.response:
        "Unknown error"),!1);resetForm()}catch(e){showAlert("\u932f\u8aa4 / Error:\x3cbr\x3e \u7db2\u8def\u932f\u8aa4\u6216\u7121\u6cd5\u9001\u51fa / Network error or unable to send",!1),resetForm()}}});