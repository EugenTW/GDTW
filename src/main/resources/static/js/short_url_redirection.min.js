'use strict';document.addEventListener("DOMContentLoaded",function(){function b(d){const a=document.createElement("div");a.style.position="fixed";a.style.left="50%";a.style.top="50%";a.style.transform="translate(-50%, -50%)";a.style.background="#bbfafa";a.style.color="#000000";a.style.padding="15px 20px";a.style.border="3px solid #16d4ff";a.style.borderRadius="5px";a.style.fontSize="16px";a.style.fontWeight="bold";a.style.zIndex="9999";a.style.textAlign="center";a.innerHTML=d;document.body.appendChild(a);
    setTimeout(function(){document.body.removeChild(a)},1500)}function c(d,a){d&&((d=d.textContent.trim())?navigator.clipboard&&window.isSecureContext&&navigator.clipboard.writeText(d).then(()=>b("\u8907\u88fd\u6210\u529f\x3cbr\x3eCopied to clipboard!")).catch(()=>b("\u8907\u88fd\u5931\u6557 / Copy failed")):b(a||"\u7121\u5167\u5bb9\u53ef\u8907\u88fd / Nothing to copy"))}const e=window.location.pathname.split("/")[1];var f=new URL(window.location.href);f=f.origin+f.pathname;if(e){const d=document.querySelector(".shorten-url");
    d&&(d.textContent=f);fetchOriginalUrlWithRetry(e,3,1E3)}else showError("\u77ed\u7db2\u5740\u7121\u6548 / Invalid short URL.");document.querySelector(".shorten-url")?.addEventListener("click",function(){c(this,"\u77ed\u7db2\u5740\u7121\u5167\u5bb9")});document.querySelector(".original-url")?.addEventListener("click",function(){c(this,"\u539f\u59cb\u7db2\u5740\u7121\u5167\u5bb9")})});
function fetchOriginalUrlWithRetry(b,c,e){function f(){d++;fetch("/su_api/get_original_url",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:b})}).then(a=>a.json()).then(handleSuccess).catch(a=>{handleFailure(a,d,c,e,f)})}let d=0;f()}
function handleSuccess(b){if(b.errorMessage)showError(b.errorMessage);else{const e=b.originalUrl;b=b.originalUrlSafe||"0";var c=document.querySelector(".original-url");c&&(c.textContent=e);if(c=document.querySelector(".button.green")){const f=c.cloneNode(!0);c.parentNode.replaceChild(f,c);f.addEventListener("click",function(){window.location.href=e})}updateGoogleSafeCheck(b)}}
function handleFailure(b,c,e,f,d){let a="\u5167\u90e8\u4f3a\u670d\u5668\u932f\u8aa4! Internal Server Error!";b instanceof Response?b.text().then(h=>{try{const g=JSON.parse(h);g.errorMessage&&(a=g.errorMessage)}catch(g){}switch(b.status){case 429:a="\u8acb\u6c42\u904e\u65bc\u983b\u7e41! Too many requests!";break;case 404:a="\u6b64\u77ed\u7db2\u5740\u5c1a\u672a\u5efa\u7acb! Original URL not found!";break;case 410:a="\u6b64\u77ed\u7db2\u5740\u5df2\u5931\u6548! The short URL is banned."}showError(a);
    b.status===429&&c<=e&&setTimeout(d,f)}):showError(a)}function showError(b){const c=document.querySelector(".original-url");c&&(c.textContent=b,c.style.color="red",c.style.fontWeight="bold")}
function updateGoogleSafeCheck(b){var c=parseInt(b,10);b=document.getElementById("google-safe-icon");const e={0:{src:"/images/circle.png",title:"Unchecked URL!"},1:{src:"/images/check.png",title:"Safe URL!"},2:{src:"/images/warn.png",title:"Unsafe URL!"}};c=e[c]||e[0];b&&(b.setAttribute("src",c.src),b.setAttribute("title",c.title))};