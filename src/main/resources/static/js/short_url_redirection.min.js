'use strict';document.addEventListener("DOMContentLoaded",function(){const b=window.location.pathname.split("/")[1];var a=new URL(window.location.href);a=a.origin+a.pathname;if(b){const c=document.querySelector(".shorten-url");c&&(c.textContent=a);fetchOriginalUrlWithRetry(b,3,1E3)}else showError("\u77ed\u7db2\u5740\u7121\u6548 / Invalid short URL.")});
function fetchOriginalUrlWithRetry(b,a,c){function e(){f++;fetch("/su_api/get_original_url",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:b})}).then(d=>d.json()).then(handleSuccess).catch(d=>{handleFailure(d,f,a,c,e)})}let f=0;e()}
function handleSuccess(b){if(b.errorMessage)showError(b.errorMessage);else{const c=b.originalUrl;b=b.originalUrlSafe||"0";var a=document.querySelector(".original-url");a&&(a.textContent=c);if(a=document.querySelector(".button.green")){const e=a.cloneNode(!0);a.parentNode.replaceChild(e,a);e.addEventListener("click",function(){window.location.href=c})}updateGoogleSafeCheck(b)}}
function handleFailure(b,a,c,e,f){let d="\u5167\u90e8\u4f3a\u670d\u5668\u932f\u8aa4! Internal Server Error!";b instanceof Response?b.text().then(h=>{try{const g=JSON.parse(h);g.errorMessage&&(d=g.errorMessage)}catch(g){}switch(b.status){case 429:d="\u8acb\u6c42\u904e\u65bc\u983b\u7e41! Too many requests!";break;case 404:d="\u6b64\u77ed\u7db2\u5740\u5c1a\u672a\u5efa\u7acb! Original URL not found!";break;case 410:d="\u6b64\u77ed\u7db2\u5740\u5df2\u5931\u6548! The short URL is banned."}showError(d);
    b.status===429&&a<=c&&setTimeout(f,e)}):showError(d)}function showError(b){const a=document.querySelector(".original-url");a&&(a.textContent=b,a.style.color="red",a.style.fontWeight="bold")}
function updateGoogleSafeCheck(b){var a=parseInt(b,10);b=document.getElementById("google-safe-icon");const c={0:{src:"/images/circle.png",title:"Unchecked URL!"},1:{src:"/images/check.png",title:"Safe URL!"},2:{src:"/images/warn.png",title:"Unsafe URL!"}};a=c[a]||c[0];b&&(b.setAttribute("src",a.src),b.setAttribute("title",a.title))};