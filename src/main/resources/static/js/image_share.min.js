'use strict';document.addEventListener("DOMContentLoaded",function(){function r(){p.innerHTML="";const a=f.map((e,c)=>new Promise(b=>{const d=new FileReader;d.onload=function(g){b({index:c,result:g.target.result,name:e.name})};d.readAsDataURL(e)}));Promise.all(a).then(e=>{e.sort((c,b)=>c.name.localeCompare(b.name));e.forEach(({index:c,result:b,name:d})=>{const g=document.createElement("div");g.className="file-item";g.innerHTML=`
                    <img src="${b}" class="thumbnail" alt="Image Preview" title="${d}">
                    <img src="/images/delete.png" class="remove-button" data-index="${c}" alt="Remove" title="Remove">
                `;p.appendChild(g)});q()})}function u(a){f.splice(a,1);f.sort((e,c)=>e.name.localeCompare(c.name));r();q()}function q(){k.disabled=f.length===0}const f=[],k=document.getElementById("upload-button"),m=document.getElementById("password-input"),t=document.getElementById("file-input"),p=document.getElementById("file-list"),v=document.getElementById("upload-area"),l=document.getElementById("upload-overlay");v.addEventListener("click",()=>t.click());t.addEventListener("change",function(a){a=
    a.target.files;let e=0;for(let c=0;c<a.length;c++){const b=a[c];if(b.type.match(/(jpg|jpeg|png|gif|webp)$/i))if(b.size>52428800)alert(`\u55ae\u6a94\u4e0d\u5f97\u8d85\u904e50MB - File too large (max 50MB): ${b.name}`);else{if(f.length>=50){alert("\u55ae\u6b21\u6700\u591a50\u500b\u6a94\u6848 - Up to 50 files only.");break}e+=b.size;if(e>524288E3){alert("\u7e3d\u6a94\u6848\u5927\u5c0f\u4e0d\u5f97\u8d85\u904e500MB - Total file size exceeds 500MB.");break}f.some(d=>d.name===b.name&&d.size===b.size)||f.push(b)}else alert(`\u4e0d\u652f\u63f4\u7684\u6a94\u6848\u683c\u5f0f - Unsupported file format: ${b.name}`)}f.sort((c,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              b)=>c.name.localeCompare(b.name));r();q()});m.addEventListener("blur",function(){const a=m.value;a&&!/^\d{4,10}$/.test(a)&&(alert("\u5bc6\u78bc\u96504~10\u4f4d\u6578\u5b57 - Password must be 4 to 10 digits."),m.value="")});k.addEventListener("click",async function(){async function a(){try{const h=await fetch("/is_api/create_new_album",{method:"POST",body:d});if(h.ok){const w=(await h.json()).sia_code;window.location.href=`/a/${w}`}else h.status===429?g<3?(g++,setTimeout(a,1E3)):(alert("\u4f3a\u670d\u5668\u5fd9\u788c\u7a0d\u5f8c\u518d\u8a66 - Server busy. Try later."),
    l.style.display="none"):(h.status===507?alert("\u4e0a\u50b3\u5931\u6557 - Upload failed: \u4f3a\u670d\u5668\u5bb9\u91cf\u4e0d\u8db3\u66ab\u505c\u6b64\u9805\u670d\u52d9 - Insufficient server storage."):alert("\u4e0a\u50b3\u5931\u6557 - Upload failed: \u672a\u77e5\u932f\u8aa4 - Unknown error."),l.style.display="none")}catch(h){console.error("\u4e0a\u50b3\u932f\u8aa4 - Error during upload:",h),alert("\u4e0a\u50b3\u904e\u7a0b\u4e2d\u767c\u751f\u932f\u8aa4 - An error occurred during the upload."),l.style.display=
    "none"}finally{setTimeout(()=>{n=!1;k.disabled=!1},1E3)}}if(!n)if(n=!0,k.disabled=!0,l.style.display="flex",f.length===0)alert("\u8acb\u81f3\u5c11\u9078\u64c7\u4e00\u500b\u6a94\u6848 - Please select at least one file."),n=!1,k.disabled=!1,l.style.display="none";else{var e=document.getElementById("expiry-select").value,c=document.querySelector('input[name\x3d"nsfw"]:checked').value==="true",b=m.value,d=new FormData;f.forEach(h=>d.append("files",h));d.append("expiryDays",e);d.append("nsfw",c);d.append("password",
    b);var g=0;a()}});p.addEventListener("click",function(a){a.target.classList.contains("remove-button")&&(a=a.target.getAttribute("data-index"),u(a))});let n=!1});